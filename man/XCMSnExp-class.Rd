% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/DataClasses.R, R/methods-MsFeatureData.R, R/methods-XCMSnExp.R
\docType{class}
\name{MsFeatureData-class}
\alias{MsFeatureData}
\alias{MsFeatureData-class}
\alias{XCMSnExp}
\alias{XCMSnExp-class}
\alias{adjustedRtime}
\alias{adjustedRtime,MsFeatureData-method}
\alias{adjustedRtime,XCMSnExp-method}
\alias{adjustedRtime<-}
\alias{adjustedRtime<-,MsFeatureData-method}
\alias{adjustedRtime<-,XCMSnExp-method}
\alias{dropAdjustedRtime}
\alias{dropAdjustedRtime,MsFeatureData-method}
\alias{dropAdjustedRtime,XCMSnExp-method}
\alias{dropFeatureGroups}
\alias{dropFeatureGroups,MsFeatureData-method}
\alias{dropFeatureGroups,XCMSnExp-method}
\alias{dropFeatures}
\alias{dropFeatures,MsFeatureData-method}
\alias{dropFeatures,XCMSnExp-method}
\alias{featureGroups}
\alias{featureGroups,MsFeatureData-method}
\alias{featureGroups,XCMSnExp-method}
\alias{featureGroups<-}
\alias{featureGroups<-,MsFeatureData-method}
\alias{featureGroups<-,XCMSnExp-method}
\alias{features}
\alias{features,MsFeatureData-method}
\alias{features,XCMSnExp-method}
\alias{features<-}
\alias{features<-,MsFeatureData-method}
\alias{features<-,XCMSnExp-method}
\alias{hasAdjustedRtime}
\alias{hasAdjustedRtime,MsFeatureData-method}
\alias{hasAdjustedRtime,XCMSnExp-method}
\alias{hasAlignedFeatures}
\alias{hasAlignedFeatures,MsFeatureData-method}
\alias{hasAlignedFeatures,XCMSnExp-method}
\alias{hasDetectedFeatures}
\alias{hasDetectedFeatures,MsFeatureData-method}
\alias{hasDetectedFeatures,XCMSnExp-method}
\alias{intensity,XCMSnExp-method}
\alias{mz,XCMSnExp-method}
\alias{processHistory}
\alias{processHistory,XCMSnExp-method}
\alias{rtime,XCMSnExp-method}
\alias{setAs}
\alias{show,MsFeatureData-method}
\alias{show,XCMSnExp-method}
\title{Data container storing xcms preprocessing results}
\usage{
\S4method{show}{MsFeatureData}(object)

\S4method{hasAdjustedRtime}{MsFeatureData}(object)

\S4method{hasAlignedFeatures}{MsFeatureData}(object)

\S4method{hasDetectedFeatures}{MsFeatureData}(object)

\S4method{adjustedRtime}{MsFeatureData}(object)

\S4method{adjustedRtime}{MsFeatureData}(object) <- value

\S4method{dropAdjustedRtime}{MsFeatureData}(object)

\S4method{featureGroups}{MsFeatureData}(object)

\S4method{featureGroups}{MsFeatureData}(object) <- value

\S4method{dropFeatureGroups}{MsFeatureData}(object)

\S4method{features}{MsFeatureData}(object)

\S4method{features}{MsFeatureData}(object) <- value

\S4method{dropFeatures}{MsFeatureData}(object)

\S4method{show}{XCMSnExp}(object)

\S4method{hasAdjustedRtime}{XCMSnExp}(object)

\S4method{hasAlignedFeatures}{XCMSnExp}(object)

\S4method{hasDetectedFeatures}{XCMSnExp}(object)

\S4method{adjustedRtime}{XCMSnExp}(object, bySample = FALSE)

\S4method{adjustedRtime}{XCMSnExp}(object) <- value

\S4method{featureGroups}{XCMSnExp}(object)

\S4method{featureGroups}{XCMSnExp}(object) <- value

\S4method{features}{XCMSnExp}(object)

\S4method{features}{XCMSnExp}(object) <- value

\S4method{rtime}{XCMSnExp}(object, bySample = FALSE)

\S4method{mz}{XCMSnExp}(object, bySample = FALSE)

\S4method{intensity}{XCMSnExp}(object, bySample = FALSE)

\S4method{processHistory}{XCMSnExp}(object, fileIndex, type)

\S4method{dropFeatures}{XCMSnExp}(object)

\S4method{dropFeatureGroups}{XCMSnExp}(object)

\S4method{dropAdjustedRtime}{XCMSnExp}(object)
}
\arguments{
\item{object}{For \code{adjustedRtime}, \code{featureGroups},
\code{features}, \code{hasAdjustedRtime}, \code{hasAlignedFeatures} and
\code{hasDetectedFeatures} either a \code{MsFeatureData} or a \code{XCMSnExp}
object, for all other methods a \code{XCMSnExp} object.}

\item{value}{For \code{adjustedRtime<-}: a \code{list} (length equal to the
number of samples) with numeric vectors representing the adjusted retention
times per scan.

For \code{featureGroups<-}: a \code{DataFrame} with feature
alignment information. See return value for the \code{featureGroups} method
for the expected format.

For \code{features<-}: a \code{matrix} with information on
detected features. See return value for the \code{features} method for the
expected format.}

\item{bySample}{logical(1) specifying whether results should be grouped by
sample.}

\item{fileIndex}{For \code{processHistory}: optional \code{numeric}
specifying the index of the files/samples for which the
\code{\link{ProcessHistory}} objects should be retrieved.}

\item{type}{For \code{processHistory}: restrict returned
\code{\link{ProcessHistory}} objects to analysis steps of a certain type.
Supported values are \code{"Unknown"}, \code{"Feature detection"},
\code{"Feature alignment"} and \code{"Retention time correction"}.}
}
\value{
For \code{adjustedRtime}: if \code{bySample = FALSE} a \code{numeric}
vector with the adjusted retention for each spectrum of all files/samples
within the object. If \code{bySample = TRUE } a \code{list} (length equal to
the number of samples) with adjusted retention times grouped by sample.
Returns \code{NULL} if no adjusted retention times are present.

For \code{featureGroups}: a \code{DataFrame} with feature alignment
information, each row corresponding to one group of aligned features (across
samples) and columns \code{"mzmed"} (median mz value), \code{"mzmin"}
(minimal mz value), \code{"mzmax"} (maximum mz value), \code{"rtmed"} (median
retention time), \code{"rtmin"} (minimal retention time), \code{"rtmax"}
(maximal retention time) and \code{"featureidx"}. Column \code{"featureidx"}
contains a \code{list} with indices of features (rows) in the matrix returned
by the \code{features} method that belong to that feature group. The method
returns \code{NULL} if no aligned feature information is present.

For \code{features}: a \code{matrix} with at least the following
columns: \code{"mz"} (mz value for the largest intensity), \code{"mzmin"} (
minimal mz value), \code{"mzmax"} (maximal mz value), \code{"rt"} (retention
time for the peak apex), \code{"rtmin"} (minimal retention time), \code{"rtmax"}
(maximal retention time), \code{"into"} (integrated, original, intensity of
the feature) and \code{"sample"} (sample index in which the feature was
identified). Depending on the employed feature detection algorithm and the
\code{verboseColumns} parameter of it additional columns might be returned.

For \code{rtime}: if \code{bySample = FALSE} a numeric vector with the
retention times of each scan, if \code{bySample = TRUE} a \code{list} of
numeric vectors with the retention times per sample.

For \code{mz}: if \code{bySample = FALSE} a \code{list} with the mz
values (numeric vectors) of each scan. If \code{bySample = TRUE} a
\code{list} with the mz values per sample.

For \code{intensity}: if \code{bySample = FALSE} a \code{list} with
the intensity values (numeric vectors) of each scan. If
\code{bySample = TRUE} a \code{list} with the intensity values per sample.

For \code{processHistory}: a \code{list} of
\code{\link{ProcessHistory}} objects providing the details of the individual
data processing steps that have been performed.
}
\description{
The \code{MsFeatureData} class is designed to encapsule all
data related to the preprocessing of metabolomics data using the \code{xcms}
package, i.e. it contains a \code{matrix} with the features identified by the
feature detection, a \code{DataFrame} with the information on aligned
features across samples and a \code{list} with the adjusted retention times
per sample.

The \code{XCMSnExp} object is designed to contain all results
from metabolomics data preprocessing (feature detection, feature alignment
and retention time correction). The corresponding elements in the
\code{msFeatureData} slot are \code{"features"} (a \code{matrix}),
\code{"featureGroups"} (a \code{DataFrame}) and \code{"adjustedRtime"} (a
\code{list} of numeric vectors). Note that these should not be accessed
directly but rather \emph{via} their accessor methods. Along with the results,
the object contains the processing history that allow to track each
processing step along with the used settings. The object also directly
extends the \code{\link[MSnbase]{OnDiskMSnExp}} object hence allowing easy
access to the full data on which the feature detection was performed.

Objects from this class should not be created directly, they are returned as
result from the \code{\link{detectFeatures}} method.

\code{XCMSnExp} objects can be coerced into \code{\linkS4class{xcmsSet}}
objects using the \code{as} method.

\code{hasAdjustedRtime}: whether the object provides adjusted
retention times.

\code{hasAlignedFeatures}: whether the object contains feature
alignment results.

\code{hasDetectedFeatures}: whether the object contains feature
detection results.

The \code{adjustedRtime},\code{adjustedRtime<-} method
extract/set adjusted retention times. Retention times are adjusted by
retention time correction/adjustment methods. The \code{bySample} parameter
allows to specify whether the adjusted retention time should be grouped by
sample (file).

The \code{featureGroups}, \code{featureGroups<-} methods extract
or set the feature alignment results.

The \code{features}, \code{features<-} methods extract or set
the matrix containing the information on identified features. See description
on the return value for details on the matrix columns. Users usually don't
have to use the \code{features<-} method directly as detected features are
added to the object by the \code{\link{detectFeatures}} method.

The \code{rtime} method extracts the retention time for each
scan. The \code{bySample} parameter allows to return the values grouped
by sample/file.

The \code{mz} method extracts the mz values from each scan of
all files within an \code{XCMSnExp} object. These values are extracted from
the original data files and eventual processing steps are applied
\emph{on the fly}. Using the \code{bySample} parameter it is possible to
switch from the default grouping of mz values by spectrum/scan to a grouping
by sample/file.

The \code{intensity} method extracts the intensity values from
each scan of all files within an \code{XCMSnExp} object. These values are
extracted from the original data files and eventual processing steps are
applied \emph{on the fly}. Using the \code{bySample} parameter it is possible
to switch from the default grouping of intensity values by spectrum/scan to
a grouping by sample/file.

The \code{processHistory} method returns a \code{list} with
\code{\link{ProcessHistory}} objects (or objects inheriting from this base
class) representing the individual processing steps that have been performed,
eventually along with their settings (\code{Param} parameter class). Optional
arguments \code{fileIndex} and \code{type} allow to restrict to process steps
of a certain type or performed on a certain file.

The \code{dropFeatures} method drops any identified features
and returns the object without that information. Note that for
\code{XCMSnExp} objects the method drops all results from a feature alignment
or retention time adjustment too. For \code{XCMSnExp} objects the method
drops also any related process history steps.

The \code{dropFeatureGroups} method drops aligned feature
information (i.e. feature groups) and returns the object
without that information. Note that for \code{XCMSnExp} objects the method
drops also retention time adjustments.
For \code{XCMSnExp} objects the method drops also any related process history
steps.

The \code{dropAdjustedRtime} method drops any retention time
adjustment information and returns the object without adjusted retention
time. Note that for \code{XCMSnExp} objects the method drops also all feature
alignment results if these were performed after the retention time adjustment.
For \code{XCMSnExp} objects the method drops also any related process history
steps.
}
\section{Slots}{

\describe{
\item{\code{.processHistory}}{\code{list} with \code{XProcessHistory} objects
tracking all individual analysis steps that have been performed.}

\item{\code{msFeatureData}}{\code{MsFeatureData} class extending \code{environment}
and containing the results from a feature detection (element
\code{"features"}), feature alignment (element \code{"featureGroups"}) and
retention time correction (element \code{""}) steps.}
}}
\note{
The \code{"features"} element in the \code{msFeatureData} slot is
equivalent to the \code{@peaks} slot of the \code{xcmsSet} object, the
\code{"featureGroups"} contains information from the \code{}
}
\examples{

## Loading the data from 2 files of the faahKO package.
library(faahKO)
od <- readMSData2(c(system.file("cdf/KO/ko15.CDF", package = "faahKO"),
                    system.file("cdf/KO/ko16.CDF", package = "faahKO")))
## Now we perform a feature detection on this data set using the
## matched filter method. We are tuning the settings such that it performs
## faster.
mfp <- MatchedFilterParam(binSize = 4)
xod <- detectFeatures(od, param = mfp)

## The results from the feature detection are now stored in the XCMSnExp
## object
xod

## The detected features can be accessed with the features method.
head(features(xod))

## The settings of the feature detection can be accessed with the
## processHistory method
processHistory(xod)

## Also the parameter class for the feature detection can be accessed
processParam(processHistory(xod)[[1]])

## The XCMSnExp inherits all methods from the pSet and OnDiskMSnExp classes
## defined in Bioconductor's MSnbase package. To access the (raw) retention
## time for each spectrum we can use the rtime method. Setting bySample = TRUE
## would cause the retention times to be grouped by sample
head(rtime(xod))

## Similarly it is possible to extract the mz values or the intensity values
## using the mz and intensity method, respectively, also with the option to
## return the results grouped by sample instead of the default, which is
## grouped by spectrum. Finally, to extract all of the data we can use the
## spectra method which returns Spectrum objects containing all raw data.
## Note that all these methods read the information from the original input
## files and subsequently apply eventual data processing steps to them.
head(mz(xod, bySample = TRUE))

## Reading all data
spctr <- spectra(xod)
## To get all spectra of the first file we can split them by file
head(split(spctr, fromFile(xod))[[1]])

############
## Filtering
##
## XCMSnExp objects can be filtered by file, retention time, mz values or
## MS level. For some of these filter preprocessing results (mostly
## retention time correction and feature alignment results) will be dropped.
## Below we filter the XCMSnExp object by file to extract the results for
## only the second file.
xod_2 <- filterFile(xod, file = 2)
xod_2

## Now the objects contains only the idenfified features for the second file
head(features(xod_2))

head(features(xod)[features(xod)[, "sample"] == 2, ])

##########
## Coercing to an xcmsSet object
##
## We can also coerce the XCMSnExp object into an xcmsSet object:
xs <- as(xod, "xcmsSet")
head(peaks(xs))
}
\author{
Johannes Rainer
}
\seealso{
\code{\linkS4class{xcmsSet}} for the old implementation.

\code{\link[MSnbase]{OnDiskMSnExp}}, \code{\link[MSnbase]{MSnExp}}
and \code{\link[MSnbase]{pSet}} for a complete list of inherited methods.

\code{\link{detectFeatures}} for available feature detection methods
returning a \code{XCMSnExp} object as a result.
}

