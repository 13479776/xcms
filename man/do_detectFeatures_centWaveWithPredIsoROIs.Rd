% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/do_detectFeatures-functions.R
\name{do_detectFeatures_centWaveWithPredIsoROIs}
\alias{do_detectFeatures_addPredIsoROIs}
\alias{do_detectFeatures_centWaveWithPredIsoROIs}
\title{Two-step centWave feature detection condidering also feature isotopes}
\usage{
do_detectFeatures_centWaveWithPredIsoROIs(mz, int, scantime, valsPerSpect,
  ppm = 25, peakwidth = c(20, 50), snthresh = 10, prefilter = c(3, 100),
  mzCenterFun = "wMean", integrate = 1, mzdiff = -0.001,
  fitgauss = FALSE, noise = 0, verboseColumns = FALSE, roiList = list(),
  firstBaselineCheck = TRUE, roiScales = NULL, snthreshIsoROIs = 6.25,
  maxCharge = 3, maxIso = 5, mzIntervalExtension = TRUE,
  polarity = "unknown")

do_detectFeatures_addPredIsoROIs(mz, int, scantime, valsPerSpect, ppm = 25,
  peakwidth = c(20, 50), snthresh = 6.25, prefilter = c(3, 100),
  mzCenterFun = "wMean", integrate = 1, mzdiff = -0.001,
  fitgauss = FALSE, noise = 0, verboseColumns = FALSE, features. = NULL,
  maxCharge = 3, maxIso = 5, mzIntervalExtension = TRUE,
  polarity = "unknown")
}
\arguments{
\item{mz}{Numeric vector with the individual m/z values from all scans/
spectra of one file/sample.}

\item{int}{Numeric vector with the individual intensity values from all
scans/spectra of one file/sample.}

\item{scantime}{Numeric vector of length equal to the number of
spectra/scans of the data representing the retention time of each scan.}

\item{valsPerSpect}{Numeric vector with the number of values for each
spectrum.}

\item{ppm}{Maximal tolerated m/z deviation in consecutive scans in parts
per million (ppm).}

\item{peakwidth}{numeric(2) with the expected approximate
feature/peak width in chromatographic space. Given as a range (min, max)
in seconds.}

\item{snthresh}{For \code{do_detectFeatures_addPredIsoROIs}:
numeric(1) defining the signal to noise threshold for the centWave algorithm.
For \code{do_detectFeatures_centWaveWithPredIsoROIs}: numeric(1) defining the
signal to noise threshold for the initial (first) centWave run.}

\item{prefilter}{numeric(2): \code{c(k, I)} specifying the prefilter
step for the first analysis step (ROI detection). Mass traces are only
retained if they contain at least \code{k} peaks with intensity \code{>= I}.}

\item{mzCenterFun}{Name of the function to calculate the m/z center of the
feature. Allowed are: \code{"wMean"}: intensity weighted mean of the feature's
m/z values, \code{"mean"}: mean of the feature's m/z values, \code{"apex"}:
use the m/z value at the peak apex, \code{"wMeanApex3"}: intensity weighted
mean of the m/z value at the peak apex and the m/z values left and right of
it and \code{"meanApex3"}: mean of the m/z value of the peak apex and the
m/z values left and right of it.}

\item{integrate}{Integration method. For \code{integrate = 1} peak limits
are found through descent on the mexican hat filtered data, for
\code{integrate = 2} the descent is done on the real data. The latter method
is more accurate but prone to noise, while the former is more robust, but
less exact.}

\item{mzdiff}{Numeric representing the minimum difference in m/z dimension
for peaks with overlapping retention times; can be negatove to allow overlap.}

\item{fitgauss}{Logical whether or not a Gaussian should be fitted to each
peak.}

\item{noise}{numeric(1) allowing to set a minimum intensity required
for centroids to be considered in the first analysis step (centroids with
intensity \code{< noise} are omitted from ROI detection).}

\item{verboseColumns}{Logical whether additional feature meta data columns
should be returned.}

\item{roiList}{An optional list of regions-of-interest (ROI) representing
detected mass traces. If ROIs are submitted the first analysis step is
omitted and feature detection is performed on the submitted ROIs. Each
ROI is expected to have the following elements specified:
\code{scmin} (start scan index), \code{scmax} (end scan index),
\code{mzmin} (minimum m/z), \code{mzmax} (maximum m/z), \code{length}
(number of scans), \code{intensity} (summed intensity). Each ROI should be
represented by a \code{list} of elements or a single row \code{data.frame}.}

\item{firstBaselineCheck}{logical(1). If \code{TRUE} continuous
data within regions of interest is checked to be above the first baseline.}

\item{roiScales}{Optional numeric vector with length equal to \code{roiList}
defining the scale for each region of interest in \code{roiList} that should
be used for the centWave-wavelets.}

\item{snthreshIsoROIs}{numeric(1) defining the signal to noise ratio cutoff
to be used in the second centWave run to identify features for predicted
isotope ROIs.}

\item{maxCharge}{integer(1) defining the maximal isotope charge. Isotopes
will be defined for charges \code{1:maxCharge}.}

\item{maxIso}{integer(1) defining the number of isotope peaks that should be
predicted for each feature identified in the first centWave run.}

\item{mzIntervalExtension}{logical(1) whether the mz range for the predicted
isotope ROIs should be extended to increase detection of low intensity peaks.}

\item{polarity}{character(1) specifying the polarity of the data. Currently
not used, but has to be \code{"positive"}, \code{"negative"} or
\code{"unknown"} if provided.}

\item{features.}{A matrix or \code{xcmsPeaks} object such as one returned by
a call to \code{link{do_detectFeatures_centWave}} or
\code{link{findPeaks.centWave}} (both with \code{verboseColumns = TRUE})
with the features for which isotopes should be predicted and used for an
additional feature detectoin using the centWave method. Required columns are:
\code{"mz"}, \code{"mzmin"}, \code{"mzmax"}, \code{"scmin"}, \code{"scmax"},
\code{"scale"} and \code{"into"}.}
}
\value{
A matrix, each row representing an identified feature. All non-overlapping
features identified in both centWave runs are reported.
The matrix columns are:
\describe{
\item{mz}{Intensity weighted mean of m/z values of the feature across scans.}
\item{mzmin}{Minimum m/z of the feature.}
\item{mzmax}{Maximum m/z of the feature.}
\item{rt}{Retention time of the feature's midpoint.}
\item{rtmin}{Minimum retention time of the feature.}
\item{rtmax}{Maximum retention time of the feature.}
\item{into}{Integrated (original) intensity of the feature.}
\item{intb}{Per-feature baseline corrected integrated feature intensity.}
\item{maxo}{Maximum intensity of the feature.}
\item{sn}{Signal to noise ratio, defined as \code{(maxo - baseline)/sd},
\code{sd} being the standard deviation of local chromatographic noise.}
\item{egauss}{RMSE of Gaussian fit.}
}
Additional columns for \code{verboseColumns = TRUE}:
\describe{
\item{mu}{Gaussian parameter mu.}
\item{sigma}{Gaussian parameter sigma.}
\item{h}{Gaussian parameter h.}
\item{f}{Region number of the m/z ROI where the peak was localized.}
\item{dppm}{m/z deviation of mass trace across scanns in ppk.}
\item{scale}{Scale on which the feature was localized.}
\item{scpos}{Peak position found by wavelet analysis (scan number).}
\item{scmin}{Left peak limit found by wavelet analysis (scan number).}
\item{scmax}{Right peak limit found by wavelet analysis (scan numer).}
}
}
\description{
The \code{do_detectFeatures_centWaveWithPredIsoROIs} performs a
two-step centWave based feature detection: features are identified using
centWave followed by a prediction of the location of the identified features'
isotopes in the mz-retention time space. These locations are fed as
\emph{regions of interest} (ROIs) to a subsequent centWave run. All non
overlapping features from these two feature detection runs are reported as
the final list of identified features.

The \code{do_detectFeatures_centWaveAddPredIsoROIs} performs
centWave based feature detection based in regions of interest (ROIs)
representing predicted isotopes for the features submitted with argument
\code{features.}. The function returns a matrix with the identified features
consisting of all input features and features representing predicted isotopes
of these (if found by the centWave algorithm).
}
\details{
For more details on the centWave algorithm see
\code{\link{centWave}}.
}
\author{
Hendrik Treutler, Johannes Rainer
}
\seealso{
Other core feature detection functions: \code{\link{do_detectFeatures_MSW}},
  \code{\link{do_detectFeatures_centWave}},
  \code{\link{do_detectFeatures_massifquant}},
  \code{\link{do_detectFeatures_matchedFilter}}
}

